# **Entity-Relationship Diagram (ERD)**

## **Project: YouTube-to-Course Generation System**

**Version:** 1.0  
**Date:** July 8, 2025  
**Author:** Systems Architecture Team  
**Backend:** Supabase (PostgreSQL)

### **1. Introduction**

This Entity-Relationship Diagram defines the complete data model for the YouTube-to-Course Generation System. The system operates with anonymous users, stores all course data in Supabase, and supports versioned course creation with public consumption links. The ERD covers course creation, AI-generated content with confidence scores, versioning, and learner session tracking.

### **2. Entity Definitions**

#### **2.1. Courses**
Represents the main course container that holds all versions and metadata.

**Attributes:**
- course_id (PK) - UUID, unique identifier for the course
- youtube_url - TEXT, original YouTube video URL
- youtube_video_id - TEXT, extracted YouTube video ID
- video_title - TEXT, title from YouTube API
- video_duration - INTEGER, video length in seconds
- video_thumbnail_url - TEXT, YouTube thumbnail URL
- channel_name - TEXT, YouTube channel name
- created_at - TIMESTAMP, course creation timestamp
- updated_at - TIMESTAMP, last modification timestamp
- creator_ip - TEXT, anonymous creator identification

#### **2.2. Course_Versions**
Stores immutable versions of courses with complete snapshots.

**Attributes:**
- version_id (PK) - UUID, unique version identifier
- course_id (FK) - UUID, references Courses.course_id
- version_number - INTEGER, incremental version number (1, 2, 3...)
- version_hash - TEXT, SHA-256 hash of complete course data
- version_notes - TEXT, optional creator notes for this version
- public_url_slug - TEXT, unique slug for public access
- is_published - BOOLEAN, whether version is publicly accessible
- created_at - TIMESTAMP, version creation timestamp
- course_data_snapshot - JSONB, complete serialized course state

#### **2.3. Video_Segments**
AI-generated video segments based on topic shifts and content analysis.

**Attributes:**
- segment_id (PK) - UUID, unique segment identifier
- course_id (FK) - UUID, references Courses.course_id
- start_timestamp - INTEGER, segment start time in seconds
- end_timestamp - INTEGER, segment end time in seconds
- segment_title - TEXT, AI-generated segment title
- segment_description - TEXT, AI-generated segment description
- is_key_concept - BOOLEAN, marked as important by creator
- confidence_score - DECIMAL(3,2), AI confidence (0.00-1.00)
- created_at - TIMESTAMP, segment creation timestamp
- creator_approved - BOOLEAN, whether creator accepted this segment

#### **2.4. Quiz_Questions**
All quiz questions generated by AI or created manually by creators.

**Attributes:**
- question_id (PK) - UUID, unique question identifier
- course_id (FK) - UUID, references Courses.course_id
- segment_id (FK) - UUID, references Video_Segments.segment_id (nullable)
- question_type - TEXT, enum: 'mcq', 'true_false', 'fill_blank', 'short_answer', 'ordering', 'matching'
- question_text - TEXT, the actual question content
- question_explanation - TEXT, explanation for the correct answer
- trigger_timestamp - INTEGER, when to show question during video
- screenshot_url - TEXT, optional screenshot reference
- confidence_score - DECIMAL(3,2), AI confidence in question quality
- is_ai_generated - BOOLEAN, true if AI-generated, false if manual
- creator_approved - BOOLEAN, creator acceptance status
- created_at - TIMESTAMP, question creation timestamp
- question_data - JSONB, type-specific data (answer choices, correct answers, etc.)

#### **2.5. Extracted_Concepts**
Key concepts identified by AI from video content.

**Attributes:**
- concept_id (PK) - UUID, unique concept identifier
- course_id (FK) - UUID, references Courses.course_id
- concept_name - TEXT, name of the concept (e.g., "Dot Product")
- concept_description - TEXT, AI-generated concept explanation
- first_mentioned_at - INTEGER, timestamp when first discussed
- importance_score - DECIMAL(3,2), AI-assigned importance (0.00-1.00)
- confidence_score - DECIMAL(3,2), AI confidence in concept extraction
- related_timestamps - JSONB, array of timestamps where concept appears
- creator_approved - BOOLEAN, creator acceptance status
- created_at - TIMESTAMP, concept extraction timestamp

#### **2.6. Video_Annotations**
Creator-added annotations at specific video timestamps.

**Attributes:**
- annotation_id (PK) - UUID, unique annotation identifier
- course_id (FK) - UUID, references Courses.course_id
- timestamp - INTEGER, exact timestamp in seconds
- annotation_type - TEXT, enum: 'note', 'warning', 'key_point', 'custom'
- annotation_text - TEXT, creator's annotation content
- is_visible_to_learners - BOOLEAN, whether learners can see this
- created_at - TIMESTAMP, annotation creation timestamp

#### **2.7. Learning_Sessions**
Tracks anonymous learner sessions and progress.

**Attributes:**
- session_id (PK) - UUID, unique session identifier
- course_version_id (FK) - UUID, references Course_Versions.version_id
- session_token - TEXT, anonymous session identifier
- current_video_position - INTEGER, last video timestamp in seconds
- total_questions_answered - INTEGER, count of answered questions
- correct_answers - INTEGER, count of correct answers
- current_score - DECIMAL(5,2), current quiz percentage
- session_start_time - TIMESTAMP, when session began
- last_activity_time - TIMESTAMP, last interaction timestamp
- session_data - JSONB, additional session state data

#### **2.8. Quiz_Attempts**
Individual question attempts within learning sessions.

**Attributes:**
- attempt_id (PK) - UUID, unique attempt identifier
- session_id (FK) - UUID, references Learning_Sessions.session_id
- question_id (FK) - UUID, references Quiz_Questions.question_id
- user_answer - JSONB, learner's submitted answer
- is_correct - BOOLEAN, whether answer was correct
- time_to_answer - INTEGER, seconds taken to answer
- attempted_at - TIMESTAMP, when attempt was made
- video_timestamp_when_answered - INTEGER, video position when answered

#### **2.9. AI_Chat_Messages**
Conversation history between learners and AI assistant.

**Attributes:**
- message_id (PK) - UUID, unique message identifier
- session_id (FK) - UUID, references Learning_Sessions.session_id
- message_type - TEXT, enum: 'user_question', 'ai_response'
- message_content - TEXT, actual message text
- video_timestamp - INTEGER, video position when message sent
- screenshot_context - TEXT, base64 encoded screenshot (optional)
- ai_confidence_score - DECIMAL(3,2), AI confidence in response
- created_at - TIMESTAMP, message timestamp

#### **2.10. System_Metrics**
System-wide analytics and performance tracking.

**Attributes:**
- metric_id (PK) - UUID, unique metric identifier
- metric_type - TEXT, enum: 'video_processing', 'question_generation', 'user_engagement'
- metric_value - DECIMAL(10,2), numeric value
- metric_metadata - JSONB, additional metric data
- recorded_at - TIMESTAMP, when metric was recorded
- course_id (FK) - UUID, references Courses.course_id (nullable)

### **3. Relationships and Cardinality**

#### **3.1. One-to-Many Relationships**

**Courses → Course_Versions (1:N)**
- One course can have many versions
- Each version belongs to exactly one course
- Business rule: Minimum 1 version required to publish

**Courses → Video_Segments (1:N)**
- One course can have many video segments
- Each segment belongs to exactly one course
- Business rule: AI generates 3-20 segments per video

**Courses → Quiz_Questions (1:N)**
- One course can have many quiz questions
- Each question belongs to exactly one course
- Business rule: Minimum 1 question required for publication

**Courses → Extracted_Concepts (1:N)**
- One course can have many extracted concepts
- Each concept belongs to exactly one course
- Business rule: AI typically extracts 5-15 concepts per video

**Courses → Video_Annotations (1:N)**
- One course can have many creator annotations
- Each annotation belongs to exactly one course
- Business rule: Unlimited creator annotations allowed

**Video_Segments → Quiz_Questions (1:N)**
- One segment can have multiple questions
- Each question can optionally belong to one segment
- Business rule: Questions can be global or segment-specific

**Course_Versions → Learning_Sessions (1:N)**
- One course version can have many learning sessions
- Each session accesses exactly one course version
- Business rule: Sessions are immutable to specific versions

**Learning_Sessions → Quiz_Attempts (1:N)**
- One session can have many quiz attempts
- Each attempt belongs to exactly one session
- Business rule: Multiple attempts per question allowed

**Learning_Sessions → AI_Chat_Messages (1:N)**
- One session can have many chat messages
- Each message belongs to exactly one session
- Business rule: Unlimited chat interactions per session

#### **3.2. Many-to-Many Relationships**

**Quiz_Questions ↔ Quiz_Attempts (N:M via Quiz_Attempts)**
- Resolved through Quiz_Attempts entity
- One question can have many attempts across sessions
- One session can attempt many questions
- Junction entity: Quiz_Attempts

### **5. Indexes for Performance**

#### **5.1. Query Performance Indexes**
```sql
-- Fast course lookup by YouTube video ID
CREATE INDEX idx_courses_youtube_video_id ON Courses (youtube_video_id);

-- Fast public course access
CREATE INDEX idx_course_versions_public_url_slug ON Course_Versions (public_url_slug);

-- Fast session lookup
CREATE INDEX idx_learning_sessions_session_token ON Learning_Sessions (session_token);

-- Fast question lookup by course and segment
CREATE INDEX idx_quiz_questions_course_segment ON Quiz_Questions (course_id, segment_id);

-- Fast chat message chronological lookup
CREATE INDEX idx_ai_chat_messages_session_time ON AI_Chat_Messages (session_id, created_at);
```

#### **5.2. Analytics Indexes**
```sql
-- Course creation analytics
CREATE INDEX idx_courses_created_at ON Courses (created_at);

-- Session activity analytics
CREATE INDEX idx_learning_sessions_activity ON Learning_Sessions (last_activity_time);

-- Question performance analytics
CREATE INDEX idx_quiz_attempts_performance ON Quiz_Attempts (question_id, is_correct);
```

### **6. Sample Data Relationships**

#### **6.1. Course Creation Flow**
```
Course (course-123)
├── Video_Segments (3 segments)
├── Quiz_Questions (8 questions, 6 AI + 2 manual)
├── Extracted_Concepts (5 concepts)
├── Video_Annotations (2 creator notes)
└── Course_Versions (v1, v2 with different questions)
```

#### **6.2. Learning Session Flow**
```
Course_Version (v2 of course-123)
└── Learning_Session (session-456)
    ├── Quiz_Attempts (5 attempts on 3 questions)
    └── AI_Chat_Messages (3 user questions, 3 AI responses)
```

### **7. Supabase-Specific Considerations**

#### **8.1. Table Creation Order**
1. Courses (no dependencies)
2. Course_Versions (depends on Courses)
3. Video_Segments (depends on Courses)
4. Quiz_Questions (depends on Courses, Video_Segments)
5. Extracted_Concepts (depends on Courses)
6. Video_Annotations (depends on Courses)
7. Learning_Sessions (depends on Course_Versions)
8. Quiz_Attempts (depends on Learning_Sessions, Quiz_Questions)
9. AI_Chat_Messages (depends on Learning_Sessions)
10. System_Metrics (depends on Courses)


This ERD provides the complete data foundation for the YouTube-to-Course Generation System, supporting all functional requirements while maintaining data integrity and performance in a Supabase environment.
